C51 COMPILER V9.00   XB_2WD                                                                05/30/2018 17:52:27 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE XB_2WD
OBJECT MODULE PLACED IN XB-2WD.OBJ
COMPILER INVOKED BY: D:\Keil_C51\C51\BIN\C51.EXE XB-2WD.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********************XB-2WD 智能车*******************************
   2          *  平台：XB-2WD + Keil4 + STC89C52    
   3          *  日期：2018-5-30
   4          *  晶振:11.0592MHZ
   5          ******************************************************************/
   6          
   7          /******************************************************************
   8          **                        头文件
   9          ******************************************************************/
  10          #include<AT89X52.H>       
  11          
  12          /******************************************************************
  13          **                       接线定义
  14          ******************************************************************/
  15          #define Left_moto_go      {P1_2=1,P1_3=0;}    //左电机正转
  16          #define Left_moto_back    {P1_2=0,P1_3=1;}       //左电机反转
  17          #define Left_moto_Stop    {P1_0=0;}                  //左电机停转                     
  18          #define Right_moto_go     {P1_4=1,P1_5=0;}       //右电机正转
  19          #define Right_moto_back   {P1_4=0,P1_5=1;}       //右电机反转
  20          #define Right_moto_Stop   {P1_1=0;}                      //右电机停转 
  21          
  22          #define Left_moto_pwm     P1_0   //PWM信号端
  23          #define Right_moto_pwm    P1_1    //PWM信号端
  24          #define Left_1_led        P3_4   // 左传感器       
  25          #define Right_1_led       P3_5   //右传感器 
  26          
  27          sbit BUZZ = P3^6;                                    //蜂鸣器引脚
  28          
  29          /******************************************************************
  30          **                       PWM调速相关变量
  31          ******************************************************************/
  32          unsigned char pwm_val_left  =0;                     //变量定义
  33          unsigned char push_val_left =0;                      //左电机占空比N/20
  34          unsigned char pwm_val_right =0;
  35          unsigned char push_val_right=0;                      //右电机占空比N/20
  36          bit Right_moto_stop=1;
  37          bit Left_moto_stop =1;
  38          unsigned  int  time=0;
  39          
  40          /******************************************************************
  41          **                       延时函数
  42          ******************************************************************/     
  43          void delay(unsigned int k){    
  44   1           unsigned int x,y;
  45   1               for(x=0;x<k;x++) 
  46   1                 for(y=0;y<2000;y++);
  47   1      }
  48          
  49          /******************************************************************
  50          **                       小车前进
  51          ******************************************************************/
  52          void  front_run(void){
  53   1               push_val_left=5;
  54   1               push_val_right=5;
  55   1               Left_moto_go;   
C51 COMPILER V9.00   XB_2WD                                                                05/30/2018 17:52:27 PAGE 2   

  56   1               Right_moto_go;  
  57   1      }
  58          
  59          /******************************************************************
  60          **                       小车左转
  61          ******************************************************************/
  62          void  left_run(void){
  63   1               push_val_left=5;
  64   1               push_val_right=5;
  65   1               Left_moto_Stop;   
  66   1               Right_moto_go;  
  67   1      }
  68          
  69          /******************************************************************
  70          **                       小车右转
  71          ******************************************************************/
  72          void  right_run(void){
  73   1               push_val_left=5;
  74   1               push_val_right=5;
  75   1               Right_moto_Stop;   
  76   1               Left_moto_go;  
  77   1      }
  78          
  79          /******************************************************************
  80          **                       小车停走
  81          ******************************************************************/
  82          void  stop(void){
  83   1               push_val_left=5;
  84   1               push_val_right=5;
  85   1               Left_moto_Stop
  86   1               Right_moto_Stop;    
  87   1      }
  88          
  89          /******************************************************************
  90          **                       左电机调速
  91          ******************************************************************/
  92          void pwm_out_left_moto(void){  
  93   1              if(Left_moto_stop){
  94   2                  if(pwm_val_left<=push_val_left)
  95   2                              Left_moto_pwm=1;
  96   2                      else
  97   2                              Left_moto_pwm=0;
  98   2      
  99   2                      if(pwm_val_left>=20)
 100   2                          pwm_val_left=0;
 101   2              }
 102   1              else
 103   1                      Left_moto_pwm=0;
 104   1      }
 105          
 106          /******************************************************************
 107          **                       右电机调速
 108          ******************************************************************/
 109          void pwm_out_right_moto(void){ 
 110   1              if(Right_moto_stop){ 
 111   2              if(pwm_val_right<=push_val_right)
 112   2                      Right_moto_pwm=1; 
 113   2                      else
 114   2                              Right_moto_pwm=0;
 115   2                      
 116   2                      if(pwm_val_right>=20)
 117   2                              pwm_val_right=0;
C51 COMPILER V9.00   XB_2WD                                                                05/30/2018 17:52:27 PAGE 3   

 118   2          }
 119   1          else
 120   1                      Right_moto_pwm=0;
 121   1      }
 122          
 123          /******************************************************************
 124          **                       定时器0初始化
 125          ******************************************************************/
 126          void timer0_Init(void){
 127   1              TMOD=0X01;
 128   1              TH0= 0XFc;                //1ms定时
 129   1              TL0= 0X18;
 130   1              TR0= 1;
 131   1              ET0= 1;
 132   1              EA = 1;                    //开总中断   
 133   1      }
 134                     
 135          /******************************************************************
 136          **                   定时器0中断服务子程序
 137          ******************************************************************/
 138          void timer0() interrupt 1 using 2 {
 139   1           TH0=0XFc;    
 140   1               TL0=0X18;
 141   1               time++;
 142   1               pwm_val_left++;
 143   1               pwm_val_right++;
 144   1               pwm_out_left_moto();
 145   1               pwm_out_right_moto();
 146   1      }
 147          
 148          /******************************************************************
 149          **                       主函数
 150          ******************************************************************/
 151          void main(void){
 152   1              unsigned char i;
 153   1              stop();             //小车停转
 154   1      
 155   1      B:      for(i=0;i<50;i++){   //判断按键S4是否按下
 156   2                      delay(1);            //1ms内判断50次，如果其中有一次被判断到K4没按下，便重新检测
 157   2                      if(P2_7!=0)      //当K4按下时，启动小车前进 按下P2_7=0，不按P2_7=0
 158   2                      goto B;          //跳转到标号B，重新检测  
 159   2              }
 160   1              BUZZ=0;              //50次检测S5确认是按下之后，蜂鸣器发出“滴”声响，然后启动小车。
 161   1              delay(50);
 162   1              BUZZ=1;              //响50ms后关闭蜂鸣器
 163   1      
 164   1              //中断实现PWM控速
 165   1          timer0_Init();
 166   1              
 167   1              //沿左白右黑的分界线走
 168   1              while(1){
 169   2                      //1表示黑，0表示白。红外线探测
 170   2                      if(Left_1_led==0&&Right_1_led==1)       //左白右黑
 171   2                         front_run();   //调用前进函数
 172   2                      else{
 173   3                              if(Left_1_led==1&&Right_1_led==1){      //左\右黑
 174   4                                      //小车左转
 175   4                                      left_run();
 176   4                              }
 177   3                              if(Right_1_led==0&&Left_1_led==0){      //左白右白
 178   4                                      //小车右转
 179   4                                      right_run();
C51 COMPILER V9.00   XB_2WD                                                                05/30/2018 17:52:27 PAGE 4   

 180   4                          }
 181   3                      }
 182   2              }
 183   1      }
 184          /******************************************************************
 185          **                        结束
 186          ******************************************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    257    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
